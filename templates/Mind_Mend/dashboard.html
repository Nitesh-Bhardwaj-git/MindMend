{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex flex-wrap justify-between items-center gap-4 mb-8">
        <h2 class="text-2xl font-semibold">My Dashboard</h2>
        <div class="flex gap-2 flex-wrap">
            <a href="{% url 'mood_tracker' %}" class="inline-flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-lg hover:bg-primary hover:text-white transition font-medium">Mood</a>
            <a href="{% url 'location_map' %}" class="inline-flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-lg hover:bg-primary hover:text-white transition font-medium">Map</a>
            <a href="{% url 'mental_health_heatmap' %}" class="inline-flex items-center gap-2 px-4 py-2 bg-amber-500/20 text-amber-800 rounded-lg hover:bg-amber-500 hover:text-white transition font-medium">ðŸ§  Heatmap</a>
            {% if is_counsellor %}
            <a href="{% url 'doctor_dashboard' %}" class="inline-flex items-center gap-2 px-4 py-2 bg-primary/10 text-primary rounded-lg hover:bg-primary hover:text-white transition font-medium">Doctor Panel</a>
            {% endif %}
        </div>
    </div>

    <!-- Widget 1: Mental health score -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 border-l-4 border-primary">
            <h5 class="font-semibold mb-2">ðŸ§  Mental health score</h5>
            <p class="text-4xl font-bold text-primary mb-1">{{ mental_health_score|default:"â€”" }}<span class="text-xl font-normal text-gray-500">/100</span></p>
            <small class="text-gray-500">From mood + assessments. Higher = better.</small>
        </div>
        <div class="md:col-span-2 bg-white rounded-2xl shadow-lg p-6">
            <h5 class="font-semibold mb-4">Recent Assessments</h5>
            {% for a in assessments %}
            <div class="flex justify-between items-center border-b border-gray-100 py-3">
                <span>{{ a.get_assessment_type_display|default:a.assessment_type }}</span>
                <span>Score: {{ a.total_score }} â€” {{ a.result_level }}</span>
                <span class="text-gray-500 text-sm">{{ a.created_at|date:"M d" }}</span>
            </div>
            {% empty %}
            <p class="text-gray-600">No assessments yet. <a href="{% url 'assessments' %}" class="text-primary font-medium hover:underline">Take one</a>.</p>
            {% endfor %}
        </div>
    </div>

    <!-- Wellness suggestions -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h5 class="font-semibold mb-4">ðŸ§˜ Wellness suggestions</h5>
        <p class="text-xs text-gray-500 mb-3">Personalised tips from your data.</p>
        {% if wellness_suggestions %}
        <ul class="space-y-2">
            {% for tip in wellness_suggestions %}
            <li class="flex items-start gap-2 text-gray-700 text-sm">
                <span class="text-primary mt-0.5">â€¢</span>
                <span>{{ tip }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-gray-600">Log mood regularly to get suggestions.</p>
        {% endif %}
    </div>

    <!-- Emotional patterns (kept) -->
    <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
        <h5 class="font-semibold mb-4">Emotional pattern detection</h5>
        <p class="text-sm text-gray-600 mb-4">Insights from your mood and activity logs (last 90 days).</p>
        {% if emotional_patterns %}
        <ul class="space-y-2">
            {% for p in emotional_patterns %}
            <li class="flex items-start gap-2 text-gray-700">
                <span class="text-primary mt-0.5">â€¢</span>
                <span>{{ p }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="text-gray-600">Keep logging mood and activities to discover patterns. <a href="{% url 'mood_tracker' %}" class="text-primary font-medium hover:underline">Track mood</a></p>
        {% endif %}
    </div>
</div>
{% endblock %}
