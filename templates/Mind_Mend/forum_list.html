{% extends 'base.html' %}
{% block title %}Anonymous Support Forum{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <h2 class="text-2xl font-semibold mb-2">Anonymous Support Forum</h2>
    <p class="text-gray-600 mb-4">Peer-to-peer discussion and support. Share experiences and connect with others—all posts can be anonymous.</p>
    <div class="flex flex-wrap gap-2 mb-4">
        <a href="{% url 'forum_list' %}" class="px-3 py-1.5 rounded-lg text-sm font-medium {% if not current_category %}bg-primary text-white{% else %}bg-gray-100 text-gray-700 hover:bg-gray-200{% endif %}">All</a>
        <a href="?category=support" class="px-3 py-1.5 rounded-lg text-sm font-medium {% if current_category == 'support' %}bg-amber-800 text-white{% else %}bg-amber-100 text-amber-900 hover:bg-amber-800 hover:text-white{% endif %}">Support</a>
        <a href="?category=discussion" class="px-3 py-1.5 rounded-lg text-sm font-medium {% if current_category == 'discussion' %}bg-amber-800 text-white{% else %}bg-amber-100 text-amber-900 hover:bg-amber-800 hover:text-white{% endif %}">Discussion</a>
        <a href="{% url 'recovery_stories' %}" class="px-3 py-1.5 rounded-lg text-sm font-medium bg-amber-100 text-amber-900 hover:bg-amber-800 hover:text-white">Recovery Stories</a>
    </div>
    {% if user.is_authenticated %}
    <a href="{% url 'forum_create' %}" class="inline-block px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition mb-6">New Post</a>
    {% endif %}
    {% for post in posts %}
    <div class="forum-post bg-white rounded-xl shadow p-4 mb-4">
        <span class="text-xs font-medium text-gray-500 uppercase">{{ post.get_category_display }}</span>
        <h5 class="font-semibold text-lg mt-1"><a href="{% url 'forum_detail' post.pk %}?focus=replies" class="text-primary hover:underline">{{ post.title }}</a></h5>
        <p class="text-gray-500 text-sm mb-2">
            {% if post.is_anonymous %}Anonymous{% else %}{{ post.author.username }}{% endif %} · {{ post.created_at|date:"M d, Y" }} [{{ post.created_at|date:"H:i" }}]
            · {{ post.reply_count }} repl{{ post.reply_count|pluralize:"y,ies" }}
        </p>
        <p class="text-gray-700">{{ post.content|truncatewords:30 }}</p>
        <div class="mt-4 flex items-center gap-3">
            <a href="{% url 'forum_detail' post.pk %}?focus=replies" class="text-primary font-medium hover:underline">View details</a>
            <a href="{% url 'forum_detail' post.pk %}?focus=reply#reply-form" class="inline-block px-3 py-1.5 bg-primary text-white rounded-lg hover:bg-primary-dark transition">Reply</a>
        </div>
    </div>
    {% empty %}
    <p class="text-gray-600">No posts yet. Be the first to share!</p>
    {% endfor %}
    {% if posts.has_other_pages %}
    <nav class="mt-6 flex gap-4">
        {% if posts.has_previous %}
        <a href="?page={{ posts.previous_page_number }}" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Previous</a>
        {% endif %}
        {% if posts.has_next %}
        <a href="?page={{ posts.next_page_number }}" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Next</a>
        {% endif %}
    </nav>
    {% endif %}
</div>
{% endblock %}
